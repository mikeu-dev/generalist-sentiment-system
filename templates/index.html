<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generalist Sentiment Analysis System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loader.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <header>
        <div class="container header-content">
            <h1>Sentiment & Opinion Mining System</h1>
            <p>Platform analisis sentimen canggih untuk pemahaman mendalam tentang opini publik.</p>
        </div>
    </header>

    <main class="container">

        <!-- Status Model -->
        <div class="status-bar">
            <span class="status-indicator"></span>
            Status Model:
            <span id="model-status" class="{{ 'status-ready' if model_trained else 'status-not-ready' }}">
                {{ 'Siap Digunakan' if model_trained else 'Belum Dilatih' }}
            </span>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('analyze')">
                <i class="ph ph-upload-simple"></i> Upload File
            </button>
            <button class="tab-btn" onclick="switchTab('search')">
                <i class="ph ph-globe"></i> Cari Dataset
            </button>
            <button class="tab-btn" onclick="switchTab('train')">
                <i class="ph ph-brain"></i> Training Model
            </button>
        </div>

        <!-- Search Section -->
        <section id="search-section" class="tab-content">
            <div class="card">
                <h2><i class="ph ph-magnifying-glass"></i> Cari Dataset & Analisis Otomatis</h2>
                <p>Masukkan topik (misal: "Ibukota Baru", "iPhone 15") untuk mencari data real-time.</p>
                <form id="search-form">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                        <input type="text" name="query" placeholder="Ketik topik atau kata kunci..." required
                            autocomplete="off" style="flex: 2; min-width: 200px;">

                        <!-- Source Selector -->
                        <select name="source" id="source-selector" style="flex: 1; min-width: 150px;">
                            <option value="all">Semua Sumber</option>
                            <!-- Will be populated dynamically -->
                        </select>

                        <select name="limit" style="flex: 0 0 120px;">
                            <option value="50">50 Data</option>
                            <option value="100" selected>100 Data</option>
                            <option value="200">200 Data</option>
                            <option value="500">500 Data</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="ph ph-magnifying-glass"></i> Cari & Analisis
                    </button>
                </form>

                <div id="search-loading" class="loading hidden">
                    <div class="terminal-loader">
                        <div class="terminal-header">
                            <div class="terminal-dot red"></div>
                            <div class="terminal-dot yellow"></div>
                            <div class="terminal-dot green"></div>
                            <span>SYSTEM_PROCESS_MONITOR_v2.0</span>
                        </div>
                        <div class="terminal-window" id="process-log">
                            <!-- Log types will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analyze Section -->
        <section id="analyze-section" class="tab-content active">
            <div class="card">
                <h2><i class="ph ph-file-text"></i> Upload Data Ulasan</h2>
                <p>Upload file CSV atau Excel yang berisi kolom ulasan untuk dianalisis.</p>
                <form id="analyze-form">
                    <!-- Model Selection -->
                    <div class="form-group">
                        <label
                            style="font-weight: 600; display: block; margin-bottom: 0.75rem; color: var(--text-primary);">Pilih
                            Model:</label>
                        <div class="radio-group">
                            <label class="radio-card selected" onclick="selectModel(this, 'default')">
                                <input type="radio" name="model_type" value="default" checked hidden>
                                <span class="radio-title"><i class="ph ph-lightning"></i> Cepat (Naive Bayes)</span>
                                <span class="radio-desc">Optimasi kecepatan, baik untuk dataset besar.</span>
                            </label>
                            <label class="radio-card" onclick="selectModel(this, 'hf')">
                                <input type="radio" name="model_type" value="hf" hidden>
                                <span class="radio-title"><i class="ph ph-brain"></i> Akurat (Deep Learning)</span>
                                <span class="radio-desc">Menggunakan Transformers. Lebih cerdas namun proses lebih
                                    lama.</span>
                            </label>
                        </div>
                    </div>

                    <div class="file-drop-area">
                        <i class="ph ph-file-arrow-up file-icon"></i>
                        <span class="fake-btn">Pilih File</span>
                        <span class="file-msg">atau drag and drop file di sini (.csv, .xlsx)</span>
                        <input class="file-input" type="file" name="file" accept=".csv, .xlsx" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="ph ph-lightning"></i> Analisis Sekarang
                    </button>
                </form>
                <div id="analyze-loading" class="loading hidden">
                    <span>Sedang memproses data...</span>
                </div>
            </div>

            <div id="results-container" class="hidden">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button id="download-btn" class="btn-secondary">
                        <i class="ph ph-download-simple"></i> Download CSV
                    </button>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>Total Ulasan</h3>
                        <p id="total-reviews">-</p>
                    </div>
                    <div class="metric-card">
                        <h3>Sentimen Dominan</h3>
                        <p id="dominant-sentiment">-</p>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Distribusi Sentimen</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="sentimentChart"></canvas>
                        </div>
                        <p id="sentiment-warning" class="warning-text hidden">Model belum dilatih.</p>
                    </div>
                    <div class="chart-card">
                        <h3>Cluster Topik (K-Means)</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="clusterChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="ph ph-table"></i> Sampel Data & Prediksi</h2>
                    <div class="table-responsive">
                        <table id="result-table">
                            <thead>
                                <tr>
                                    <th>Teks Ulasan</th>
                                    <th>Preprocessing</th>
                                    <th>Sumber</th>
                                    <th>Sentimen</th>
                                    <th>Cluster</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Train Section -->
        <section id="train-section" class="tab-content">
            <div class="card">
                <h2><i class="ph ph-graduation-cap"></i> Training Model Baru</h2>
                <p>Latih ulang model Naive Bayes dengan dataset khusus Anda.</p>
                <div class="alert-info"
                    style="background-color: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; padding: 12px 16px; margin-bottom: 20px; font-size: 0.9em; border-radius: 4px; color: #93c5fd;">
                    <i class="ph ph-info" style="vertical-align: middle; margin-right: 5px;"></i>
                    Format wajib: Kolom <strong>text</strong> dan <strong>label</strong>.
                </div>
                <form id="train-form">
                    <div class="file-drop-area">
                        <i class="ph ph-database file-icon"></i>
                        <span class="fake-btn">Pilih Dataset Training</span>
                        <span class="file-msg">Format .csv atau .xlsx</span>
                        <input class="file-input" type="file" name="file" accept=".csv, .xlsx" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="ph ph-play"></i> Mulai Training
                    </button>
                </form>
                <div id="train-loading" class="loading hidden">Sedang melatih model...</div>
                <div id="train-result" class="hidden"></div>

                <!-- Evaluation Metrics Section -->
                <div id="train-metrics" class="hidden"
                    style="margin-top: 2rem; border-top: 1px solid var(--glass-border); padding-top: 2rem;">
                    <h3><i class="ph ph-chart-bar"></i> Evaluasi Model</h3>

                    <div class="metrics-grid" style="margin-bottom: 20px;">
                        <div class="metric-card"
                            style="background: rgba(22, 101, 52, 0.2); border-color: rgba(74, 222, 128, 0.2);">
                            <div style="font-size: 0.9em; color: #86efac;">Akurasi</div>
                            <div id="metric-accuracy" style="font-size: 2em; font-weight: bold; color: #4ade80;">-</div>
                        </div>
                        <div class="metric-card"
                            style="background: rgba(30, 64, 175, 0.2); border-color: rgba(96, 165, 250, 0.2);">
                            <div style="font-size: 0.9em; color: #93c5fd;">Versi Model</div>
                            <div id="metric-version" style="font-size: 1.5em; font-weight: bold; color: #60a5fa;">-
                            </div>
                        </div>
                    </div>

                    <h4>Laporan Klasifikasi</h4>
                    <div class="table-responsive">
                        <table id="classification-report-table" class="table-sm">
                            <thead>
                                <tr>
                                    <th>Kelas</th>
                                    <th>Precision</th>
                                    <th>Recall</th>
                                    <th>F1-Score</th>
                                    <th>Support</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <h4 style="margin-top: 20px;">Confusion Matrix</h4>
                    <div class="table-responsive">
                        <table id="confusion-matrix-table" class="table-sm" style="text-align: center;">
                            <!-- Will be populated by JS -->
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <div class="container"
            style="text-align: center; color: var(--text-muted); padding: 3rem 0 2rem 0; font-size: 0.85em;">
            <p>&copy; 2025 Generalist Sentiment Analysis System.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>